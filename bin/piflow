#!/bin/bash
SERVER="10.0.86.191"
PORT="8002"
function help_info () {
  echo "Usage:"
  echo ""
  flow_help
  echo ""
  group_help
  echo ""
  project_help
}

function flow_help () {
  echo "        piflow  flow            start   [ ***.json ]"
  echo "                                stop    [ appId ]"
  echo "                                info    [ appId ]"
  echo "                                log     [ appId ]"
}

function group_help () {
  echo "                flowGroup       start   [ ***.json ]"
  echo "                                stop    [ groupId ]"
  echo "                                info    [ groupId ]"
}

function project_help () {
  echo "                project         start   [ ***.json ]"
  echo "                                stop    [ projectId ]"
  echo "                                info    [ projectId ]"
}

function flow_process () {
  if [ $# -eq 2 ]
  then
    case "$1" in
      start)
        flow_start $2 
        ;;
      stop)
        flow_stop $2 
        ;;
      info)
        flow_info $2 
        ;;
      log)
        flow_log $2
        ;;
      *)
        flow_help
        ;;
    esac
  else
    echo $1
    flow_help
  fi 
}

function flow_start () {
  echo "Flow Start:"
  #content=file_reader $1
  content=$(file_reader $1)
  curl_command="curl -0 -X POST http://$SERVER:$PORT/flow/start -H \"Content-type: application/json\" -d '$content'"
  #echo $curl_command
  eval $curl_command
}

function flow_info () {
  echo "Flow Info:"
  curl_command="curl -Get http://$SERVER:$PORT/flow/info?appID=$1"
  #echo $curl_command
  eval $curl_command
}

function flow_stop () {
  echo "Flow Stop:"
  curl_command="curl -POST http://$SERVER:$PORT/flow/stop -H \"Content-type: application/json\" -d '{\"appID\":\"$1\"}'"
  #echo $curl_command
  eval $curl_command
}

function flow_log () { 
  echo "Flow Log:" 
  curl_command="curl -GET http://$SERVER:$PORT/flow/log?appID=$1" 
  #echo $curl_command
  eval $curl_command
}

function file_reader () {
  #bak=$IFS
  content=""
  if [ ! -f "$1" ];then
   echo "the $1 is not a file"
   exit
  fi
  #IFS="\t"
  while read line  
  do
     #echo "$line"
     content=`echo -e "${content}\n${line}"`
  done < "$1"
  echo $content
  #IFS=$bak
}

#file_reader $1

SERVICE=""
if [ $# -gt 0 ]; then 
  case "$1" in 
    flow)
      SERVICE=flow
      ;; 
    flowGroup)
      SERVICE=flowGroup
      ;;
    project)
      SERVICE=project
      ;;
    *)
      ;;
  esac
fi

if [[ $SERVICE = "" ]]
then
  help_info

elif [[ $SERVICE = flow ]]
then 
  #echo "Flow process!!!!!!!!"
  #flow_process $2 $3
  echo "$(flow_process $2 $3 2>/dev/null)"
  #`echo -e "${ret}\n"`  
  
else
  help_info
fi


